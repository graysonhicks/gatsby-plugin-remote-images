# Migration Guide

#### v1 or v2 â†’ v3

`gatsby-plugin-remote-images` 1.x and 2.x supported creating the new image file
field at arbitrary levels above the node containing the source image URL field.
This is no longer available in v3.x and the new image file field will be created
on the same node where the URL field exists. This was a trade-off made to fall
in line with Gatsby's current schema customization techniques and also to add
support for creating local images from URL fields generated by
[`gatsby-source-graphql`](https://www.gatsbyjs.org/packages/gatsby-source-graphql/).

To update your project for `gatsby-plugin-remote-images` v3, perform the
following steps:

1. Rename the `name` plugin option to `imageFileField` in `gatsby-config.js`:

   ```diff
        {
          resolve: `gatsby-plugin-remote-images`,
          options: {
            nodeType: 'myNode',
            imagePath: 'path.to.imageUrl',
   -        name: 'myLocalImage',
   +        imageFileField: 'myLocalImage',
          },
        },
   ```

1. Replace the `imagePath` plugin option with `imageUrlField` in
   `gatsby-config.js`:

   ```diff
        {
          resolve: `gatsby-plugin-remote-images`,
          options: {
   -        nodeType: 'myNode',
   -        imagePath: 'path.to.imageUrl',
   +        nodeType: 'typeOfPathDotTo',
   +        imageUrlField: 'imageUrl',
            imageFileField: 'myLocalImage',
          },
        },
   ```

   You will need to examine your schema to determine the new value for
   `nodeType`. In the example above, it would be the type of the `to` node.

   ```
   {
     allMyNode {
       edges {
         node {           # type: myNode
           path {
             to {         # <-- the type of this node is what you want
               imageUrl   # string containing the URL
               localImage # new image file field will be added here
             }
           }
         }
       }
     }
   }
   ```

   This new method does not care whether your target `nodeType` is nested in an
   array or not as it is referencing nodes directly rather than traversing a
   path. If you were previously using the `imagePath` array literal syntax to
   target nodes in an array, everything above still applies and you just need to
   identify the appropriate node type:

   ```diff
        {
          resolve: `gatsby-plugin-remote-images`,
          options: {
   -        nodeType: 'myNode',
   -        imagePath: 'childNodes[].imageUrl',
   +        nodeType: 'childNode',
   +        imageUrlField: 'imageUrl',
            imageFileField: 'myLocalImage',
          },
        },
   ```

1. Update your queries to request the new image file field off the source node
   (where the URL field exists) rather than any "higher-level" node where you
   may have been putting it before:

   ```diff
   {
     allMyNode {
       edges {
         node {
   -       localImage
   +       path {
   +         to {
   +           imageUrl   # now required!
   +           localImage
   +         }
   +       }
         }
       }
     }
   }
   ```

   **N.B.** Be sure to include the image URL field in your query. Due to the way
   Gatsby schema customization works in this particular case, the new image file
   nodes are created dynamically and require this value to be present in order
   to resolve.
